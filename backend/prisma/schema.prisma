// FINANCE AUDIT LOGS MICROSERVICE SCHEMA
// ============================================================================

generator client {
provider = "prisma-client-js"
}

datasource db {
provider = "postgresql"
url      = env("AUDIT_LOGS_DATABASE_URL")
}

// ============================================================================
// ACTION TYPES REFERENCE TABLE
// ============================================================================

model action_type {
id          Int        @id @default(autoincrement())
code        String     @unique   // e.g., CREATE, UPDATE, DELETE, APPROVE, REJECT
description String?
is_active   Boolean    @default(true)
created_at  DateTime   @default(now())
updated_at  DateTime   @updatedAt

audit_logs  audit_log[]
}

// ============================================================================
// AUDIT LOGS
// ============================================================================

model audit_log {
id              Int       @id @default(autoincrement())
entity_type     String
entity_id       String
action_type_id  Int       // FK â†’ action_type
action_by       String?
action_at       DateTime  @default(now())
previous_data   Json?     // store only fields that changed
new_data        Json?     // store only fields that changed
version         Int       @default(1) // versioning for the same entity changes
ip_address      String?
created_at      DateTime  @default(now())

// versioning to be strictly sequential per entity
@@unique([entity_type, entity_id, version])

// Relations
action_type     action_type @relation(fields: [action_type_id], references: [id])

@@index([entity_type, entity_id])
@@index([action_type_id])
@@index([action_by])
@@index([entity_type, action_type_id, action_at])
@@index([action_at])
@@index([ip_address])
}

// END OF FINANCE AUDIT LOGS MICROSERVICE SCHEMA